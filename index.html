<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Canvasgram</title>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<link rel="stylesheet" href="//cssgram-cssgram.netdna-ssl.com/cssgram.min.css">
	<style>
		#my_file {
		    display: none;
		}

		#get_file {
		    background: #f9f9f9;
		    border: 5px solid #88c;
		    padding: 15px;
		    border-radius: 5px;
		    margin: 10px;
		    cursor: pointer;
		}

		#virtual, .none {
			display: none;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-md-12 text-center">
				<h2>Canvasgram</h2>
				<hr>
				<input type="button" id="get_file" value="Upload Image">
				<input type="file" id="my_file" accept="image/*;capture=camera">
			</div>

			<div class="col-md-4 col-md-offset-4">
				<img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			</div>
		</div>
		
		<!-- Start Filter Images Here -->
		<div class="row">
			<hr>

			<!-- Start 1997 -->
			<div class="col-md-4">
				<figure class="_1977">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	1997 - <button class="btn btn-default download" data-class="_1997">Download</button>
			    </h3>
			</div>
			
			<!-- Start Aden -->
			<div class="col-md-4">
				<figure class="aden">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Aden - <button class="btn btn-default download" data-class="aden">Download</button>
			    </h3>
			</div>

			<!-- Start Brooklyn -->
			<div class="col-md-4">
				<figure class="brooklyn">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Brooklyn - <button class="btn btn-default download" data-class="brooklyn">Download</button>
			    </h3>
			</div>

			<!-- Start Clarendon -->
			<div class="col-md-4">
				<figure class="clarendon">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Clarendon - <button class="btn btn-default download" data-class="clarendon">Download</button>
			    </h3>
			</div>

			<!-- Start Earlybird -->
			<div class="col-md-4">
				<figure class="earlybird">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Earlybird - <button class="btn btn-default download" data-class="earlybird">Download</button>
			    </h3>
			</div>

			<!-- Start Gingham -->
			<div class="col-md-4">
				<figure class="gingham">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Gingham - <button class="btn btn-default download" data-class="gingham">Download</button>
			    </h3>
			</div>
			
			<!-- Start Hudson -->
			<div class="col-md-4">
				<figure class="hudson">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Hudson - <button class="btn btn-default download" data-class="hudson">Download</button>
			    </h3>
			</div>

			<!-- Start Inkwell -->
			<div class="col-md-4">
				<figure class="inkwell">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Inkwell - <button class="btn btn-default download" data-class="inkwell">Download</button>
			    </h3>
			</div>

			<!-- Start Lark -->
			<div class="col-md-4">
				<figure class="lark">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Lark - <button class="btn btn-default download" data-class="lark">Download</button>
			    </h3>
			</div>

			<!-- Start Lo-Fi -->
			<div class="col-md-4">
				<figure class="lofi">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Lo-Fi - <button class="btn btn-default download" data-class="lofi">Download</button>
			    </h3>
			</div>

			<!-- Start Mayfair -->
			<div class="col-md-4">
				<figure class="mayfair">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Mayfair - <button class="btn btn-default download" data-class="mayfair">Download</button>
			    </h3>
			</div>

			<!-- Start Moon -->
			<div class="col-md-4">
				<figure class="moon">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Moon - <button class="btn btn-default download" data-class="moon">Download</button>
			    </h3>
			</div>

			<!-- Start Nashville -->
			<div class="col-md-4">
				<figure class="nashville">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Nashville - <button class="btn btn-default download" data-class="nashville">Download</button>
			    </h3>
			</div>

			<!-- Start Perpetua -->
			<div class="col-md-4">
				<figure class="perpetua">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Perpetua - <button class="btn btn-default download" data-class="perpetua">Download</button>
			    </h3>
			</div>

			<!-- Start Reyes -->
			<div class="col-md-4">
				<figure class="reyes">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Reyes - <button class="btn btn-default download" data-class="reyes">Download</button>
			    </h3>
			</div>

			<!-- Start Slumber -->
			<div class="col-md-4">
				<figure class="slumber">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Slumber - <button class="btn btn-default download" data-class="slumber">Download</button>
			    </h3>
			</div>

			<!-- Start Toaster -->
			<div class="col-md-4">
				<figure class="toaster">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Toaster - <button class="btn btn-default download" data-class="toaster">Download</button>
			    </h3>
			</div>

			<!-- Start Walden -->
			<div class="col-md-4">
				<figure class="walden">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Walden - <button class="btn btn-default download" data-class="walden">Download</button>
			    </h3>
			</div>

			<!-- Start Willow -->
			<div class="col-md-4">
				<figure class="willow">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	Willow - <button class="btn btn-default download" data-class="willow">Download</button>
			    </h3>
			</div>

			<!-- Start X-pro II -->
			<div class="col-md-4">
				<figure class="xpro2">
				    <img src="img.jpg" class="canvasgram_img img-responsive" alt="Your image">
			    </figure>
			    <h3>
			    	X-pro II - <button class="btn btn-default download" data-class="xpro2">Download</button>
			    </h3>
			</div>

		</div>
		<!-- End Filter Images -->
		
		<!-- Canvas -->	
		<div class="row none">
			<div class="col-md-12">
				<canvas id="download-canvas" width="890" height="592"></canvas>
			</div>
		</div>
		<!-- End Canvas -->
	</div>

	<div id="virtual">
		<style id="virtual-style">
			
		</style>
		
		<div id="virtual-image">
		    <img src="img.jpg" class="canvasgram_img" alt="Your image">
	    </div>
	</div>
	
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script src="//cburgmer.github.io/rasterizeHTML.js/rasterizeHTML.allinone.js"></script>
	<script>
		$(document).ready(function() {

			$('#get_file').click(function() {
				$('#my_file').click();
			});

			$('#my_file').change(function() {
				base64($('input[type="file"]'), function(data){
					$(".canvasgram_img").attr("src", "data:image/png;base64," + data.base64);
					var image_width = document.querySelector('.canvasgram_img').naturalWidth;
					var image_height = document.querySelector('.canvasgram_img').naturalHeight;
					$('#download-canvas').attr('width', image_width);
					$('#download-canvas').attr('height', image_height);
				});
			});

			//Download
			$('.download').click(function() {
				var css_class_name = $(this).attr('data-class');
				var css_class_path = 'css/' + css_class_name + '.css';

				//Get CSS
				$.get( css_class_path ).done(function( data ) {
					//Apply user selected CSS
				    $('#virtual-style').append(data);
				    $('#virtual-image').addClass(css_class_name);

				    var canvas = document.getElementById("download-canvas"),
					    context = canvas.getContext('2d'),
					    html_container = document.getElementById("virtual"),
					    html = html_container.innerHTML;
					
					rasterizeHTML.drawHTML(html, canvas, canvas.width, canvas.height).then(function (renderResult) {
						
					    context.drawImage(renderResult.image, 0, 0, canvas.width, canvas.height);
					    window.open(document.querySelector('canvas').toDataURL());
					});
				});
			});

			function base64(file, callback){
				var coolFile = {};
				function readerOnload(e){
					var base64 = btoa(e.target.result);
					coolFile.base64 = base64;
					callback(coolFile);					
				};

				var reader = new FileReader();
				reader.onload = readerOnload;

				var file = file[0].files[0];
				coolFile.filetype = file.type;
				coolFile.size = file.size;
				coolFile.filename = file.name;
				reader.readAsBinaryString(file);
			}
		});
	</script>
</body>
</html>